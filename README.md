# ESP8266_DHT22

Прошивка для ESP8266 (07) для управления принудительной вентиляцией в погребе.

Принцип работы: производится несколько замеров абсолютной влажности внутри вентилируемого помещения и снаружи, которые потом усредняются и принимается решение включить вентилятор или выключить если он включен. 
Использование внешнего датчика обусловлено тем, что если влажность снаружи выше, то включать вентиляцию не надо.

Датчики подключены к 12 и 14 пинам, назначение датчиков (внешний или внутренний задается константами).
Реле управления вентилятором подключено на 4 пин.

В устройстве не заложена индикация работы, вся информация передается на MQTT сервер, с него же устройство и получает настройки.

Передаваемые значения на MQTT:
1. Значения температуры, относительной и абсолютной влажности, количество считанных значений для каждого датчика в формате JSON
2. Информация о включенном (выключенном) вентиляторе 

Получаемые настройки с MQTT:
1. Команда принудительного включения вентилятора
2. Пороговое значение влажности, % (отностительная), при которой будет включен вентилятор
3. Гистерезис влажности, % (относительная) - дельта, при снижении на заданное значение вентилятор будет выключен
4. Минимальная температура внутри, ниже которой вентиляция не будет включена

Значения, установленные по умолчанию:
1. Принудительное включение отключено
2. Вентиляция выключена
3. Пороговое значение влажности 90%
4. Гистерезис 1%
5. Минимальная температура внутри 1 градус цельсия.
6. Количество замеров для принятия решения и отправки данных 5.
7. Интервал опроса датчиков 5 сек.

##Building

[esp8266-wiki](https://github.com/esp8266/esp8266-wiki/wiki/Toolchain)

Add to .profile
PATH="/opt/Espressif/crosstool-NG/builds/xtensa-lx106-elf/bin/:$PATH"

Make!




